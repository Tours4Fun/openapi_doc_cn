# Toursforfun tour package docking document

**last updated date：** 2023-03-03

**VERSION：**`1.1`

**View modification history：** [Click here](updatelog_en.md)

# Apply for APPKEY
Before calling product/order-related APIs, please apply for Toursforfun OPENAPI APPKEY from our business colleagues, and activate the corresponding permissions before calling APIs.

**Secret Key:**

    SECRET_KEY is issued together with APPKEY, please keep this secret key properly and do not disclose it. This key is an important credential for server-side signature verification.
    Please refer to the next chapter for specific API calling methods.

# Call API

## Gateway address:

    https://openapi.tufengwang.com

## Call API

### Request protocal

Please note that the API calls use the HTTP protocol, and the `POST` method is used for calls, and the gateway only supports `POST` calls.

### Request parameters

When the API is called, the parameter is expressed in `JSON`, and is attached to the http request as an Http Body.
At the same time, add `Content-Type: application/json; charset=utf-8` to HTTP HEADER.

For example:

```javascript
{
    "product_id":123
}
```

### System parameters

System parameters are appended directly after the api url, for example:

    https://openapi.tufengwang.com/v2/product/detail?appkey=xxxxxx&sign=xxxxx&t=xxxxx&lang=zh_tw


**System parameters list:**

| parameter    | type |             description               |
| :------: |:--------:|:------------------------------:|
| appkey   |  string  | OpenAPI appkey   |
| t        |  int     | timestamp，The time difference with toursforfun server must be within 10 minutes.  |
| sign     |  string  | Parameter signature value, calculated from appkey, t, request parameter.|
| lang     |  string  | Optional, language option, value cn (default), en, es.  |


### How to generate "sign"?

The signature algorithm is mainly used to generate the system parameter `sign`. Generated by:

    md5(appkey + t + appsecret + request parameters(json string))
[signature example](./api/sign_usage.md)

## Response

Regardless of whether the HTTP CODE is wrong or not, it will return 200, and the specific return content determines whether it is correct or wrong.

```javascript
{
    "code" : 0, //status code, 0 success, Non-zero means error code
    "msg" : "", //response message, If the API response is successful, the default is "success", otherwise it means an error message.
    "data" : {}, //Data content, determined by the API, may be an array, string, array, object, etc.
}
```


## Error code map

| CODE             |          MSG         |
| -----------------|:--------------------:|
| 10001|Sign Error|
| 10002|Frequency Limit|
| 10003|APP Has Not Activated|
| 10004|Load APP Info Failed|
| 10005|Permission Not Allow|
| 10006|Black List|
| 20001|Product Detail Not Found|
| 20002|Product Availabilities Not Found|
| 20003|Product Upgrades Not Found|
| 20004|Search Product Failed|
| 20005|Product Departure Not Found|
| 20006|Product List Failed|
| 20007|Parameter Error|
| 20008|Product Ids To Much|
| 30001|Add Order Failed|
| 30002|Cal Price Error|
| 30003|Get Order List Failed|
| 30004|Get Order Detail Failed|
| 30005|At least one adult per-room!|
| 30006|Invalid Contact Information|

## Order status map

| CODE    |  SMG  |
| --------|:-----:|
| 100|Unpaid |
| 110|Payment failed |
| 200|Paid |
| 300|Processing|
| 310|Second confirmation required |
| 320|On reservation |
| 330|Refunding |
| 340|Ticket issued |
| 500|Completed |
| 600|Canceling |
| 610|Refunded |
| 700|Cancelled|

## Order product status map

| CODE    |  SMG  |
| --------|:-----:|
| 10000|Unpaid |
| 10010|Payment failed |
| 25000|Processing |
| 30000|On reservation |
| 30010|Comfirmed |
| 30011|Booking failed |
| 30100|Second confirmation required |
| 30300|Refunding |
| 40000|Ticket issued |
| 60010|Refunding |
| 60100|Refunded |
| 60020|Refund successful |
| 60030|Canceled |
| 80000|Completed |

# API List

----

| API Type    |  URL   |
| ---------- |:--------:|
|  Product API   | [Go to view](./api/product_en.md) |
|  Order API   | [Go to view](./api/order_en.md) |

# Ordering Process Guide

----

[Ordering Process Guide](./api/guide_en.md)
