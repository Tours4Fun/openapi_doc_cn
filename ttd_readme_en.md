# Toursforfun TTD docking document

**Last update:** 2019-01-25

**Version:**`1.0`

**Update history:**

--------
- 2019-01-28 Released v1.0


# Apply APPKEY
Before calling product/order-related APIs, please apply for Toursforfun OPENAPI APPKEY from our business colleagues, and activate the corresponding permissions before calling APIs.

**Secret Key:**

    SECRET_KEY is issued together with APPKEY, please keep this secret key properly and do not disclose it. This key is an important credential for server-side signature verification.
    Please refer to the next chapter for specific API calling methods.

# Call API

## Gateway Address:

    https://openapi.tufengwang.com

## Call API

### Request protocal

Please note that the API calls use the HTTP protocol, and the `POST` method is used for calls, and the gateway only supports `POST` calls.

### Reqeust parameters

When the API is called, the parameter is expressed in `JSON`, and is attached to the http request as an Http Body.
At the same time, add `Content-Type: application/json; charset=utf-8` to HTTP HEADER.

For example:

```javascript
{
    "product_id":123
}
```

### System parameters

System parameters are appended directly after the api url, for example:

    https://openapi.tufengwang.com/ttd/product/detail?appkey=xxxxxx&sign=xxxxx&t=xxxxx&lang=zh_tw


**System parameters list:**

| 参数名    | 数据类型 |             说明               |
| :------: |:--------:|:------------------------------:|
| appkey   |  string  | OpenAPI appkey   |
| t        |  int     | timestamp，The time difference with toursforfun server must be within 10 minutes.   |
| sign     |  string  | Parameter signature value, calculated from appkey, t, request parameter. |
| lang     |  string  | Optional, language option, value cn (default), en, es.|


### How to generate "sign"?

The signature algorithm is mainly used to generate the system parameter `sign`. Generated by:

    md5(appkey + t + appsecret + request parameters(json string))

[signature example](./api/sign_usage.md)

## Response

HTTP CODE 不管是否错误，均返回 200，由具体返回内容确定正确或错误。

```javascript
{
    "code" : 0, //status code, 0 success, Non-zero means error code
    "msg" : "", //response message, If the API response is successful, the default is "success", otherwise it means an error message.
    "data" : {}, //Data content, determined by the API, may be an array, string, array, object, etc.
}
```


## 错误状态码

| CODE             |          MSG         |
| -----------------|:--------------------:|
| 10001|Sign Error|
| 10002|Frequency Limit|
| 10003|APP Has Not Activated|
| 10004|Load APP Info Failed|
| 10005|Permission Not Allow|
| 10006|Black List|
| 20001|Product Detail Not Found|
| 20002|Product Availabilities Not Found|
| 20003|Product Upgrades Not Found|
| 20004|Search Product Failed|
| 20005|Product Departure Not Found|
| 20006|Product List Failed|
| 20007|Parameter Error|
| 20008|Product Ids To Much|
| 30001|Add Order Failed|
| 30002|Cal Price Error|
| 30003|Get Order List Failed|
| 30004|Get Order Detail Failed|
| 30005|At least one adult per-room!|
| 30006|Invalid Contact Information|


# API list

-----------------
* Product
  * [Product list](./api/product/ttd/list.md) (Get ttd product list)
  * [Product info](./api/product/ttd/detail.md) (Get product detail)
  * [Product price](./api/product/ttd/price.md) (Get product price)
* Order
  * [Create order](./api/order/ttd/add.md) (Create order)
  * [Order list](./api/order/ttd/list.md) (Get order list)
  * [Order info](./api/order/ttd/detail.md) (Get order detail)
  * [Cancel order](./api/order/ttd/cancel.md) (Cancel order)
* Rate
  * [Currency exchange rate](./api/product/ttd/rate.md) (Get currency exchange rate)



# Ordering Process Guide

----
[Ordering Process Guide](./api/guide_en.md)
